<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<script src="../../bower_components/moment/moment.js"></script>

<dom-module id="cam-event-thumb">
  <template>
    <style>
      .thumbbox {
        background-color: black;
        background-size: cover;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }
      .thumbsize {
        width: 320px;
        height: 180px;
      }
      .tlink {
        text-decoration: none;
        color: inherit;
      }
    </style>
    <paper-card>
    <div on-tap="eventClicked_">
      <a class="tlink" href="javascript:void(0);">
        <div id="tbox" class="thumbbox thumbsize" on-mouseover="hoverVideo_" on-mouseout="hideVideo_">
          <video id="vthumb" class="thumbsize" loop preload="none" autoplay hidden="true">
                  HTML5 video tag unsupported.
          </video>
          <template is="dom-if" if="[[showEmpty_(event)]]">
            <div>Preview Unavailable</div>
          </template>
        </div>
      </a>
            </div>
      <div>
              <div>
                [[formatAsDate_(event.Timestamp)]]
              </div>
              <div>
                [[formatAsTime_(event.Timestamp)]]
              </div>
      </div>
    </paper-card>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class CamEventThumb extends Polymer.Element {
      static get is() { return 'cam-event-thumb'; }
      static get properties() {
        return {
                event: {
                        type: Object,
                        value: null,
                        observer: 'eventChanged_',
                }
        };
      }

      formatAsDate_(tsec) {
              return moment.unix(tsec).format("dddd, MMM D, YYYY");
      }
      formatAsTime_(tsec) {
              return moment.unix(tsec).format("h:mm A");
      }

      eventClicked_() {
              if (this.event.HaveVideo) {
                      this.dispatchEvent(new CustomEvent('open-event', {detail: {event: this.event}}));
              }
      }

      eventChanged_(newValue, oldValue) {
              if (!!newValue && newValue.HaveThumb) {
                      this.$.tbox.style.backgroundImage = "url(/thumb?id=" + newValue.ID + ")";
              } else {
                      this.$.tbox.style.backgroundImage = "";
							}
      }

      hoverVideo_() {
              if (!this.showVThumb_(this.event)) {
								return;
							}
              this.$.vthumb.src = "/vthumb?id=" + this.event.ID;
							this.$.vthumb.hidden = false;
      }

      hideVideo_() {
              if (!this.showVThumb_(this.event)) {
								return;
							}
							this.$.vthumb.hidden = true;
              this.$.vthumb.src = "";
      }

      showVThumb_(e) {
              if (!e) {
                      return false;
              }   
              return e.HaveVThumb;
      }

      showEmpty_(e) {
              if (!e) {
                      return false;
              }   
              return !e.HaveThumb;
      }
    }

    window.customElements.define(CamEventThumb.is, CamEventThumb);
  </script>
</dom-module>
